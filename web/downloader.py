#! /usr/bin/env python

import urllib
import os
import sys
import time

def monitor(blocknum, blocksize, totalsize):
	'''
	@blocknum: downloaded
	@blocksize: size of data
	@totalsize: total size of remote file
	'''
	if totalsize == -1:
		sys.stdout.write('\r')
		sys.stdout.write("Small file, downloading...")
		sys.stdout.flush()
		time.sleep(0.1)
		
	else: 
		per = 100 * blocknum * blocksize / totalsize
		percent = 100.0* blocknum * blocksize / totalsize
		if percent > 100 :
			percent = 100
			sys.stdout.write('\r')
			sys.stdout.write("[%s%s] %d%%" % ('#'* per, ' '*(100 - per), per))
			sys.stdout.flush()
			time.sleep(0.1)
			print "\n### DONE ###"
		else:
			sys.stdout.write('\r')
			sys.stdout.write("[%s%s] %d%%" %('#'*per, ' '*(100-per), per))
			sys.stdout.flush()
			time.sleep(0.1)
#			print "\n### DONE ###"

#url = "http://downloads.skullsecurity.org/passwords/phpbb.txt.bz2"
url = "http://www.baidu.com"
dir = os.path.abspath('.')
parser = url.split('/')
filename = parser[-1]
work_path = os.path.join(dir, filename)
print "### STRAT Downloading ###"
urllib.urlretrieve(url, work_path, monitor)
