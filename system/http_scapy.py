#!/usr/bin/env python


from scapy.all import *
import re

def httpfilter(packet):
	if packet.haslayer(Raw):
		p= str(packet["Raw"])
		header = p.split("\r\n")
	
		if re.match("^GET.+",header[0]):
			method = "GET"
			printHeader(method,p)

		if re.match("^POST.+", header[0]):
			method = "POST"
			printHeader(method,p)
		if re.match("^HTTP.+", header[0]):
#			print "find a response packet!!"
			method = "RESPONSE"
			printHeader(method,packet)
	else:
		pass


'''
	http_packet = str(packet)
	if http_packet.find("GET"):
	     	method = "GET"
		return printHeader(method,packet)
	elif http_packet.find("POST"):
		method = "POST"
		return printHeader(method, packet)
	#pass
'''
def printHeader(method,header):
	if method == "RESPONSE":
		ret = "***************************************" + method + " PACKET****************************************************\n"
    		ret += "\n".join(header.sprintf("{Raw:%Raw.load%}\n").split(r"\r\n"))
    		ret += "*****************************************************************************************************\n"
		print ret
	else:
		ret = "**********************************" + method +" PACKET********************************************************\n"
		ret += "\n".join(header.split(r"\r\n"))
		ret += "\n*****************************************************************************************************\n"
		print ret
sniff(iface="ens33", filter="tcp and port 80",prn = httpfilter)
